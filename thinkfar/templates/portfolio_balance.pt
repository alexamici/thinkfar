<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    metal:use-macro="main.macros['main']">

  <tal:head metal:fill-slot="head">
  <link rel="stylesheet" type="text/css" href="${request.application_url}/s/resources/css/ext-all-notheme.css" />
  <link rel="stylesheet" type="text/css" href="${request.application_url}/s/resources/css/xtheme-gray.css" />
  <script type="text/javascript" src="${request.application_url}/s/adapter/ext/ext-base.js"></script>
  <script type="text/javascript" src="${request.application_url}/s/ext-all.js"></script>
  <script type="text/javascript">
    grid_rest_url = '${route_url('portfolio_rest', request, portfolio_id=portfolio.id)}'
    grid_title = 'Portfolio at ${date.isoformat()}'
    grid_date = '${date.isoformat()}',
    grid_limit = 50;
    grid_columns = [
        new Ext.grid.RowNumberer({header: '#'}),
        {id: 'name', header: "Account", width: 100, sortable: true, dataIndex: 'name'},
    ];
  </script>
  <script type="text/javascript" src="${request.application_url}/s/thinkfar.grid.js"></script>
  </tal:head>

  <tal:content metal:fill-slot="content">
    <div id="content">
      <h2 class="title">${title}</h2>
      <ol>
        <li><a href="${route_url('portfolio_default',request,portfolio_id=portfolio.id)}">summary</a></li>
        <li><a href="${route_url('portfolio_balance',request,portfolio_id=portfolio.id)}">balance</a></li>
        <li><a href="${route_url('portfolio_income',request,portfolio_id=portfolio.id)}">income</a></li>
      </ol>
      <div id="query"></div>
      <br />
      <h3>portfolio at ${date.isoformat()}</h3>
      <table>
        <thead>
          <tr>
            <th>Account</th>
            <th>Den.</th>
            <th>Asset accounts</th>
            <th>Accounts</th>
            <th>Total accounts</th>
          </tr>
        </thead>
        <tbody align="right">
          <tal:totalaccount tal:repeat="total_account portfolio.total_balance_sheet_accounts()">
          <tal:subtotalaccount tal:repeat="subtotal_account total_account.children_accounts">
          <tal:account tal:repeat="account subtotal_account.children_accounts">
          <tal:assetaccount tal:repeat="asset_account account.children_accounts">
          <tr tal:condition="asset_account.definition and asset_account.balance(date)">
            <td align="left">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${asset_account.asset.name} account</td>
            <td>${asset_account.denomination.identity}</td>
            <td>${asset_account.sign_balance(date)}</td>
            <td></td>
            <td></td>
          </tr>
          </tal:assetaccount>
          <tr tal:condition="account.definition and account.balance(date)">
            <td align="left">&nbsp;&nbsp;&nbsp;&nbsp;${account.definition.name}</td>
            <td>${account.denomination.identity}</td>
            <td></td>
            <td>${account.sign_balance(date)}</td>
            <td></td>
          </tr>
          </tal:account>
          <tr tal:condition="subtotal_account.definition and subtotal_account.balance(date)">
            <td align="left">&nbsp;&nbsp;${subtotal_account.definition.name}</td>
            <td>${subtotal_account.denomination.identity}</td>
            <td></td>
            <td></td>
            <td>${subtotal_account.sign_balance(date)}</td>
          </tr>
          </tal:subtotalaccount>
          <tr>
            <th align="left">${total_account.definition.name}</th>
            <th>${total_account.denomination.identity}</th>
            <th></th>
            <th></th>
            <th>${total_account.sign_balance(date)}</th>
          </tr>
          </tal:totalaccount>
          <tr tal:define="(asset, liabilities) portfolio.total_balance_sheet_accounts();
              (revenue, expenses) portfolio.total_income_statment_accounts()">
            <th align="left">${asset.definition.name} - ${liabilities.definition.name}</th>
            <th>${asset.denomination.identity}</th>
            <th></th>
            <th></th>
            <th>${asset.sign_balance(date) - liabilities.sign_balance(date)}</th>
          </tr>
          <tr tal:define="(revenue, expenses) portfolio.total_income_statment_accounts()">
            <th align="left">Current Profit/Loss</th>
            <th>${revenue.denomination.identity}</th>
            <th></th>
            <th></th>
            <th>${revenue.sign_balance(date) - expenses.sign_balance(date)}</th>
          </tr>
        </tbody>
      </table>
      <div id="grid"></div>
    </div>
  </tal:content>
</html>
